---
title: "Final Project Analysis"
author: "Husayn Jessa, Sarah Kipping, Mathew Tracey, Aidan Bodner"
date: "14/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Packages}
library(tidyverse) # load the installed package for each new session of R
library(broom) # helps for storing regression output
library(here) # for file organization
library(gtsummary) # For creating summary statistics table
library(gt) # For outputting gt objects

```

```{r Data Cleaning}
here() # Set working directory
raw_data <- read.csv("/Users/aidanbodner/Documents/GitHub/HAD5744-Group-Project/1. Data/data.csv", 
                     na.strings = c(" ", "", "NA", "9999: Missing")) # Load original data

analysis_data <- raw_data[, c("self_rated_mental_health", "occupation",
                              "employment_impact_not_employed", "money_concerned",
                              "housing_satisfaction", "work_unsustainable",
                              "employment_impact_laid_off", "work_from_home")]

# Scan through analysis dataframe to see variable class types
for(values in names(analysis_data)){
  print(names(analysis_data[values]))
  name <- names(analysis_data[values])
  print(class(analysis_data[,values]))
} # all variables are characters

# Remove people who were not working before the COVID-19 pandemic
analysis_data <- analysis_data[!analysis_data$employment_impact_not_employed == "I was not employed or self-employed before the COVID-19", ]

# Clean Labels 
analysis_data$employment_impact_laid_off[analysis_data$employment_impact_laid_off == "8888: Not Selected"] <- "No"
analysis_data$employment_impact_laid_off[analysis_data$employment_impact_laid_off == "I was laid off temporarily or permanently"] <- "Yes"

analysis_data$work_unsustainable[analysis_data$work_unsustainable == "8888:Not Working During COVID"] <- "I was not working during COVID-19"

# Convert to factor
analysis_data[, 1:8] <- lapply(analysis_data[, 1:8], as.factor)
```


```{r Summary Statistics}
table_data <- analysis_data[, c("self_rated_mental_health", "occupation", 
                                "money_concerned","housing_satisfaction", 
                                "work_unsustainable", "employment_impact_laid_off")]

summary_table <- tbl_summary(analysis_data, include = c("self_rated_mental_health", "occupation",
                                                           "money_concerned","housing_satisfaction", 
                                                           "work_unsustainable", "employment_impact_laid_off"),
                             label = list(self_rated_mental_health ~ "Self-Rated Mental Health",
                                                      occupation ~ "Occupation",
                                                      money_concerned ~ "Concerned that the money I have or will save wont last", housing_satisfaction ~ "Satisfaction with current living arrangements", work_unsustainable ~ "Work-load is unsustainable", employment_impact_laid_off ~ "Laid off temporarily or permanently"), missing = "no", type = list(employment_impact_laid_off ~ "categorical")) %>%
  as_gt %>%
  gt::gtsave(filename = "//Users//aidanbodner//Desktop//Summary.html")


# Cross tab between occupation and unemployment
descr::crosstab(analysis_data$employment_impact_not_employed, analysis_data$employment_impact_laid_off)

descr::crosstab(analysis_data$employment_impact_laid_off, analysis_data$work_from_home)


```

